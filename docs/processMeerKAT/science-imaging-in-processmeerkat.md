---
layout: default
title: Science Imaging in processMeerKAT
parent: processMeerKAT
nav_order: 9
---

# Science Imaging

*Note:*
1. *Our selfcal and science imaging workflow generally assumes a fixed image size, and may perform sub-optimally (e.g. sources missing from the CLEAN mask) if the image size changes at any point*
2. *Imaging at higher spectral resolution (i.e. with more frequency channels) requires higher computational power / runtime, and may require increasing the time limit of your imaging jobs. In general we recommend self-calbrating at 1k (1024 channels). If your raw data is at higher spectral resolution, consider first averaging in frequency with the `width` or `chanbin` config parameters (also see spectral-line pre-processing [here](/docs/processMeerKAT/advanced-usage#spectral-line-pre-processing))*

processMeerKAT implements science imaging using the `tclean` task in
[CASA](https://casadocs.readthedocs.io/en/stable/) to generate the images, and
the katbeam package to perform primary beam correction on the final image.

The science imaging functionality exposes more of the advanced imaging
capabilities of `tclean` and is intended to be run after all the
self-calibration loops. By default the final imaging mask generated by
self-calibration is passed in to science imaging, as well as the final set of
outlier fields (if [outlier imaging](/docs/processMeerKAT/self-calibration-in-processmeerkat#outlier-imaging) is enabled).

Similarly, the final `rmsmap` is passed in to science imaging, to enable S/N-based thresholding (see below).
It is possible to run science imaging immediately after cross-calibration, without running selfcal, although these three fields
will not be populated, but would need to be manually set based on a pre-existing set of custom output (e.g. a mask, RMS map and outlier file).

Science imaging is expected to be run once, preferably at the end of self-calibration, and
unlike self-calibration it does not accept tuples as arguments.

### A note on PB correction

If the CASA gridders `standard` or `wproject` are used the default `.pb` image
generated is incorrect for MeerKAT. We therefore use the package `katbeam` to
perform the PB correction. The final data products are the flat noise image
(produced by CASA), the `katbeam` PB image as well as the PB corrected image.

The `katbeam` package describes the MeerKAT PB as an axis-symmetric `cos^2`
function. In a future release of the pipeline we intend to support the AW
projection algorithm, which will produce a correct `.pb` image for MeerKAT from
within tclean, in full Stokes.


## Science Imaging Config Options

The default science imaging section in the config file is shown below, and the details of each option are explained further down.

```
[image]
cell = '1.5arcsec'
robust = -0.5
imsize = [6144, 6144]
wprojplanes = 512
niter = 50000
threshold = 10                    # S/N value if >= 1.0 and rmsmap != '', otherwise Jy
multiscale = [0, 5, 10, 15]
nterms = 2                        # Number of taylor terms
gridder = 'wproject'
deconvolver = 'mtmfs'
restoringbeam = ''
specmode = 'mfs'
stokes = 'I'
pbthreshold = 0.1                 # Threshold below which to mask the PB for PB correction
mask = ''
rmsmap = ''
outlierfile = ''
```


* **cell**: The cell size of the pixels in the image plane, specified as a CASA
  compatible string (with units).

* **robust**: The Briggs' robust parameter used during gridding. Specified as a
  floating point between -2 (uniform weighting) and +2 (natural weighting).

* **imsize**: The size of the image in pixels. The image dimensions can be
  specified in one or two dimensions, hence 6144 is treated as [6144,6144].

* **wprojplanes** : The number of W-projection planes to use (in case the
  `wproject` gridder is specified). Must be specified as an integer.

* **niter**: The number of iterations to perform during deconvolution. Imaging
  will continue until either the stopping threshold (described below) is
  reached, or the iteration limit is reached.

* **threshold**: The stopping threshold for deconvolution. If the threshold
  value is larger than 1 and the `rmsmap` parameter is not blank, the value is
  treated as a signal-to-noise ratio. If the threshold value is less than 1, or
  if it is greater than 1 and the `rmsmap` parameter is blank, it is treated as
  an absolute value in Jy. If science imaging is requested after
  self-calibration, the `rmsmap` parameter will be auto-populated by the
  pipeline.

* **multiscale**; The number of individual scales to use if multi-scale imaging
  is desired (and the appropriate `deconvolver` is chosen - e.g. `mtmfs` or `multiscale`) specified as a list
  of integers such as [0, 5, 10] etc. To switch off multiscale imaging, specify
  a blank list (*i.e.,* `multiscale=[]`).

* **nterms** : The number of Taylor terms to use for broadband imaging.

* **gridder** : The gridder to use for imaging, typically one of either
  `standard` or `wproject`. Any CASA gridder is a valid entry for this
  parameter, although all the necessary configuration options for different
  gridders will not be exposed through the configuration file.

* **deconvolver** : The deconvolver to use during imaging. Use `clark` or `hogbom` when the fractional bandwidth (bandwidth divided by band centre) is < ~15%.

* **restoringbeam** : Specified as a string with units, such as `'20arcsec'`. If
  this is left blank, the default restoring beam is used. Specifying this
  parameter can be used to force a specific restoring beam during imaging.

* **specmode** : Specify whether to generate a multi-frequency synthesis image
  (`mfs`) or a spectral cube (`cube` or `cubedata`).

* **stokes** : The Stokes planes to image. Please note that generating
  multi-Stokes spectral cubes or multi-Stokes cubes with outliers, is not currently possible within CASA

* **pbthreshold** : The PB gain threshold below which to mask the PB and the PB
  corrected image. The PB is generated using the `katbeam` package.

* **mask** : Path to a CLEAN mask or a CASA region file. This is normally
  auto-populated by the pipeline if science imaging is queued up after
  self-calibration. However, if science imaging is being launched manually, this
  will have to be specified if masking is desired. If the parameter is left
  blank, no masking will be performed.

* **rmsmap** : Path to an RMS image, used to determine local thresholds during
  deconvolution. This is normally auto-populated by the pipeline if science
  imaging is queued up after self-calibration. If this is left blank, the
  `threshold` parameter is assumed to be an absolute (global) threshold in Jy.

* **outlierfile** : Path to a valid outlier fields file. This is normally
  auto-populated by the pipeline if science imaging is queued up after
  self-calibration. If this is left blank, no [outlier imaging](/docs/processMeerKAT/self-calibration-in-processmeerkat#outlier-imaging) is performed.
